---
chapter_no: 50
chapter_title: ケース５ SQLインジェクション攻撃によるパスワード変更 〜コメントアウトで無効化〜
created: 2008-04-12
updated: 2021-04-01
---
さて、今度は[ケース４](#ケース４ SQLインジェクション攻撃によるパスワード変更 〜シングルクォート挿入〜)の応用で全データを変更するパターンの攻撃についてご紹介しましょう。

### 攻撃手法
利用するテーブル、条件は[ケース４](#ケース４ SQLインジェクション攻撃によるパスワード変更 〜シングルクォート挿入〜)と同様とし、悪意あるユーザが全ユーザのパスワードを「`malice`」への書き換えを試みる際に入力するパラメータは以下のようになります。

<dl>
  <dt>$userId</dt>
  <dd>' OR 'A' = 'A' --</dd>
  <dt>$oldPasswd</dt>
  <dd> (何も入力しない) </dd>
  <dt>$newPasswd</dt>
  <dd>malice</dd>
</dl>

結果、生成されるSQL文は以下のようなものになります。

```:SQL
UPDATE ユーザマスタ SET パスワード = 'malice' WHERE ユーザID = '' {em{OR 'A' = 'A' --' AND パスワード = ''}em}
```

[ケース３](#ケース３ SQLインジェクション攻撃による任意のSQL文実行 〜コメントアウトで無効化〜)と同様に「`'A' = 'A'`」の恒真式にしつつ、それ以降をコメントアウトしてWHERE句を無効化しています。結果、全員のパスワードが「`malice`」に変更されてしまいます。  
更新後のテーブルの様子は以下のようになります。

<table class="normal">
    <caption>テーブル名：ユーザマスタ(更新後)</caption>
    <tr><th>ユーザID</th><th>パスワード</th></tr>
    <tr><td>admin</td><td><strong>malice</strong></td></tr>
    <tr><td>fumo</td><td><strong>malice</strong></td></tr>
    <tr><td>cynthia</td><td><strong>malice</strong></td></tr>
    <tr><td>rose</td><td><strong>malice</strong></td></tr>
</table>