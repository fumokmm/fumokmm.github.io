---
chapter_no: 20
chapter_title: 実装方法
created: 2022-02-02
updated: 2022-02-02
---
- 基本的には、`__enter__`メソッドと、`__exit__`メソッドを定義するだけです。
- `__exit__`メソッドの`exc_type`, `exc_value`, `traceback`は、コンテキスト内で例外が発生した場合に渡されます。
  - 例外が発生していないときは`None`です。
- `__enter__`メソッドで`return`している`self`が、`withブロック`で`as`として受け取った変数となります。

```
class MyContextManager:
    {em{def __enter__(self):
        print('1 ENTER!')}em}
        {em:blue{return self}em}

    {em{def __exit__(self, exc_type, exc_value, traceback):
        print('4 EXIT!')}em}

    def foo(self):
        print('3 FOO!')

# テストプログラム
with MyContextManager() {em:blue{as cm}em}:
    print('2 ** hello **')
    {em:blue{cm}em}.foo()
```

```output:出力結果
{em{1 ENTER!}em}
2 ** hello **
3 FOO!
{em{4 EXIT!}em}
```
