---
chapter_no: 9
chapter_title: トランザクション
created: 2021-10-24
updated: 2021-10-24
---
トランザクションは[オートコミット](#オートコミット)が`False`の時に利用できます。  
トランザクション関連のメソッドは以下。
<table class="normal">
	<tr>
		<th markdown="span">メソッド名</th>
		<th markdown="span">説明</th>
	</tr>
	<tr>
		<td markdown="span">commit</td>
		<td markdown="span">トランザクションをコミットします。</td>
	</tr>
	<tr>
		<td markdown="span">rollback</td>
		<td markdown="span">トランザクションをコミットします。</td>
	</tr>
	<tr>
		<td markdown="span">close</td>
		<td markdown="span">コネクションをクローズします。</td>
	</tr>
</table>

- コミットするときは明示的に`commit()`を呼び出すようにします。
- `close()`した時に常に`rollback()`が呼び出されます。

### トランザクションの分離レベル
ODBCでは、以下4つの分離レベルがサポートされています。
<table class="normal">
	<tr>
		<th markdown="span">トランザクションの分離レベル</th>
	</tr>
	<tr>
		<td markdown="span">SQL_TXN_READ_UNCOMMITTED</td>
	</tr>
	<tr>
		<td markdown="span">SQL_TXN_READ_COMMITTED</td>
	</tr>
	<tr>
		<td markdown="span">SQL_TXN_REPEATABLE_READ</td>
	</tr>
	<tr>
		<td markdown="span">SQL_TXN_SERIALIZABLE</td>
	</tr>
</table>

トランザクションの分離を設定するには、コネクションの`.set_attr`を使って`pyodbc.SQL_ATTR_TXN_ISOLATION`に設定します。
```
cnxn = pyodbc.connect(conn_str, autocommit=True)
cnxn{em{.set_attr(}em}{em:blue{pyodbc.SQL_ATTR_TXN_ISOLATION, pyodbc.SQL_TXN_SERIALIZABLE}em}{em{)}em}
cnxn.autocommit = False  {em:comment{# enable transactions}em}
```
