---
chapter_no: 20
chapter_title: さっそくやってみよう
created: 2020-11-07
updated: 2022-01-09
---
さっそくやって行きましょう。SQL Serverでは、`FOR XML PATH`を使うことで実現することができます。

```:SQL
SELECT
    a.TEAM AS TEAM,
    (SELECT ',' + MEMBER FROM Table1 b WHERE b.TEAM = a.TEAM ORDER BY b.NO {em{FOR XML PATH('')}em}) AS MEMBER
FROM
    Table1 a
```

### 取得結果

|TEAM|MEMBER|
|----|------|
|紅組|,佐藤,鈴木,高橋|
|紅組|,佐藤,鈴木,高橋|
|紅組|,佐藤,鈴木,高橋|
|青組|,田中|
|黄組|,伊藤,渡辺|
|黄組|,伊藤,渡辺|

いい感じになってきましたが、先頭の `,` が邪魔なので[STUFF関数](#stuff)を使って除去してみましょう。  
[STUFF関数](#stuff)を組み込んでみるとこうなります。取得する先頭に`,`が付くので、それを除去しています。

```:SQL
SELECT
    a.TEAM AS TEAM,
    {em{STUFF(}em}
        (SELECT ',' + MEMBER FROM Table1 b WHERE b.TEAM = a.TEAM ORDER BY b.NO FOR XML PATH(''))
        {em{, 1, 1, ''}em}
    {em{)}em} AS MEMBER
FROM
    Table1 a
```

### 取得結果

|TEAM|MEMBER|
|----|------|
|紅組|佐藤,鈴木,高橋|
|紅組|佐藤,鈴木,高橋|
|紅組|佐藤,鈴木,高橋|
|青組|田中|
|黄組|伊藤,渡辺|
|黄組|伊藤,渡辺|

あともう一歩ですね。重複して出てきてしまっているデータをまとめてみましょう。

```:SQL
SELECT
    a.TEAM AS TEAM,
    STUFF(
        (SELECT ',' + MEMBER FROM Table1 b WHERE b.TEAM = a.TEAM ORDER BY b.NO FOR XML PATH(''))
        , 1, 1, ''
    ) AS MEMBER
FROM
    {em{(SELECT DISTINCT TEAM FROM Table1)}em} a
{em{ORDER BY
	a.TEAM}em}
```

### 取得結果

|TEAM|MEMBER|
|----|------|
|黄組|伊藤,渡辺|
|紅組|佐藤,鈴木,高橋|
|青組|田中|

これで完成です。SQLはちょっとごちゃごちゃしますが、わりと簡単にできるみたいですね。
