---
title: 下書きのメモ
display_order: 10
created: 2022-10-03
updated: 2022-10-03
---
IT関連の下書きのメモです。  
編集の都合上、突然内容が変更されることもありますのでご了承ください。

## <a name="index">目次</a><a class="heading-anchor-permalink" href="#目次">§</a>

<ul id="index_ul">
<li><a href="#AWSのメモ">AWSのメモ</a></li>
</ul>

* * *
## <a name="AWSのメモ">AWSのメモ</a><a class="heading-anchor-permalink" href="#AWSのメモ">§</a>
<div class="chapter-updated">{% include update_info_inline.html created="2022-10-03" updated="2022-10-03" %}</div>
### 用語的なところ
- AWSにおいてネットワークは「VPC」、サーバーは「EC2インスタンス」。
- 個人アカウントのセキュリティ管理「IAM」。
- 多要素認証「MFA」。

- パブリックIPアドレスとグローバルIPアドレスは同じ意味。
  - AWSでは通常パブリックIPアドレスという用語が使われる。

- プライベートIPアドレスはインターネットで利用されることがないIPアドレスで、組織内のネットワークで誰もが自由に使用できる。
  - クラスA 10.0.0.0～10.255.255.255
  - クラスB 172.16.0.0～172.31.255.255
  - クラスC 192.168.0.0～192.168.255.255

- インバウンド、アウトバウンド
  - インバウンドとは「外側からサーバ側」に向けた通信。
  - アウトバウンドは「サーバ側から外側」への通信。

### セキュリティグループ
- EC2インスタンスとネットワークの間には、パケットフィルタリング型のファイアウォールが付けられていて、不要なパケットを除去する機能がある。これをセキュリティグループと言う。
- デフォルトのセキュリティグループの設定は「インバウント方向はすべて拒否」に設定されている。
  - 明示的にセキュリティグループ設定を変更しない限りこのEC2インスタンスにはどこからもアクセスできない。
  - アウトバウンドに対する制限は課せられておらず、すべての通信が許可されている。

### 仮想ネットワーク(VPC)
- AWSにおいてネットワークを構成するサービスがAmazon Virtual Private Cloud(Amazon VPC)。
- Amazon VPCは契約者ごとにネットワークを構成する場所を提供する
- 契約者は最初にVPC領域を作る。  
  → その中に細分化したサブネットを作る  
  → これが仮想的なネットワークとなる

- AWSではリージョンごとに最大5つの「ネットワークを構築できる場所」が作れる。この場所のことを「VPC領域」と言う。
- VPC領域同士は完全に独立しており、異なるVPC領域感で、直接通信することはできない。
  - 異なるVPC領域間で通信したいときはVPCピア接続を構成するか、VPC領域間でVPNを構成する。

- サブネットに対して、トラフィックの出入りを制御するネットワークACL(Access Control List)という設定がある。  
  → パケットフィルタリングを構成できる。
- VPC領域にはルーターが存在するのが前提なので、図では、ルーター、ネットワークACL、セキュリティグループが省略されることがほとんど。
- AWSでは、同じVPC領域い属するネットワーク同士はVPC領域に内蔵されているルーターによって暗黙的につながるので注意する。

### VPC領域を切り分けて作るサブネット
- 利用するIPアドレス範囲の枠組みを決める
- サブネットを作る
- いずれかのアベイラビリティゾーンに配置する
- ひとつのサブネットがアベイラビリティゾーンをまたぐことはない

### VPC領域にはプライベートIPアドレスを割り当てる
- プライベートIPアドレスは範囲の中から任意のものを指定する
- たとえインターネットにつなぐときでも、プライベートIPアドレスを使う
- VPC領域に対して直接パブリックIPアドレスを使うことはない  
  → たとえVPC領域にパブリックIPアドレスを指定したとしても、ルーティングされないので無意味。
  - VPCをインターネットに接続するときは、インターネットゲートウェイという一種のNATを構成することで、  
    プライベートIPアドレスに加えて、パブリックIPアドレスを追加で割り当てるという構成にする
  - VPC領域はVPN接続や専用線を使って、オフィスなどの物理的なネットワークと相互に接続することも可能  
    → 将来オンプレミスとの相互接続を考慮するなら、オフィスやデータセンターなどで利用していないIPアドレス範囲を使うことを推奨する。

### VPC領域のIPアドレス範囲は大きめにとる
- VPC領域を作るときに決めたIPアドレス範囲はあとから変更できない
- VPC領域は最大で65536個のネットワークアドレスを割り当てることができるため、通常は最大数を指定する

### CIDR表記
- AWS内でのIPアドレスの分割方法には、主にCIDR(Classless Inter-Domain Routing)というクラスレスアドレス表記を使用する。  
  → CIDRは「サイダー」と読む。
- ネットワーク部とホスト部
  - IP(Internet Protocol)は複数のネットワークが接続され環境で通信を行うためのプロトコルであり、宛先、送信元のホストを特定するために  
    32ビットのIPアドレス(IPv4アドレス)が使われる。
  - これは、0～255までの4つの数字をピリオドで区切った形で表される。
  - 1つのパートが8ビットに対応し、全体で32ビットの数値として構成されている
  - 32ビットのうち、一部の上位ビットはネットワークを識別する部分（ネットワーク部）、  
    残りの下位ビットがホストを識別する部分（ホスト部）となる。
  - 「10.0.0.0/16」は「左から16ビット分がネットワーク部」という意味。(16だとちょうど半々) 
    - 「10.0.0.0/16」では先頭の「10.0」がネットワーク部で固定となるので、残る下2つ「0.0」～「255.255」がホスト部としての割り当てとなり、  
      「10.0.0.0」～「10.0.255.255」のIPアドレス範囲を利用するという意味になる。
  - ネットワーク部はIPアドレスをグループ化する値で、「この値が同じもの同士が、互いに直接通信できる」ことを示す。
  - ホスト部は実際にコンピュータなどの端末（ホスト）に割り当てる重複しない値の範囲を示す。
  - IPアドレスには使う決まりがあるため、先頭と末尾のものは使えない
    - 先頭はネットワークアドレス（この例の場合は「10.0.0.0」）
    - 末尾は同報送信の際の宛先として使われるブロードキャストアドレス（この例の場合は「10.0.255.255」）

### CIDRはネットワークの大きさを決める
- CIDRはネットワーク部とホスト部の区切り部分を決めるものだが、見方を変えるとネットワークの大きさを変えるものであるとも言える。
- CIDRを左に寄せるほどネットワークは大きくなり、よりたくさんの端末を接続できるようになる
- CIDRを右に寄せるほどネットワークは小さくなり、少ない端末しか接続できなくなるが、利用できるネットワークの総数は増える
- AWSにおいてはほとんどの場合、VPC領域は使用上の最大となる「/16」でよいはず。
- サブネットについては端末（ホスト、EC2インスタンス）を何台接続するのか、いくつのサブネットに分けるのかによって、設定値を適宜調整する。

### インターネットゲートウェイ（インターネットに接続するための）
- VPCをインターネットに背盗賊するには、VPCに対してインターネットウェイ(Internet Gateway。IGWと略される)を接続する。
- インターネットゲートウェイを構成したあと、サブネットやサーバーに対しパブリックIPアドレスを割り当て、適切にルーティングを設定することで、インターネットに接続できるようになる。

### VPC領域と他のネットワークとの接続
- さまざまな接続ポイント
  - １．インターネットとの接続（→ インターネットゲートウェイ）
  - ２．オフィスなどの拠点と専用線で接続（→ AWS Direct Connect）
  - ３．オフィスなどの拠点とVPNで接続（→ VPN Gateway）
  - ４．VPCピア接続（→ 同一のリージョンにおける別のVPCと接続する機能。異なるAWSユーザーのVPCとも接続できる）
  - ５．AWSサービスとの接続（VPCとAWSのほかのマネージドサービスとの接続点、VPCエンドポイントと言う）

### デフォルトのVPCの構成
- １．VPC領域のIPアドレス範囲は「172.31.0.0/16」
- ２．構成されるサブネット
  - １のIPアドレス郡の中から「/20」のサイズでサブネットが作られ、それぞれアベイラビリティゾーンに配置される
  - 仮にアベイラビリティゾーンが３つあるリージョンなら各アベイラビリティゾーンにサブネットが作られる
    - アベイラビリティゾーンA 172.31.0.0/20
    - アベイラビリティゾーンB 172.31.16.0/20
    - アベイラビリティゾーンC 172.31.32.0/20
- インターネットへの接続
  - インターネットゲートウェイがせていされており、インターネット接続ができる。
  - それぞれのサブネットに対して、インターネット接続できるようパブリックIPアドレスが割り当てられるようにしたり、  
    ルーティングしたりするように構成されている。
  - このサブネットに配置されたEC2インスタンスはパブリックIPアドレスとプライベートIPアドレスの2つのIPアドレスを持ち、  
    インターネットに接続できる。
- 公開したいインスタンスだけ億
- 変更や削除をしないほうがよい
  - デフォルトのVPCは少し特殊なVPC領域なので変更や削除をしないほうが無難。
  - 削除してしまうと作り直すことができない。
  - 作り直してもらうにはAWSに依頼して作り直してもらう必要がある。

### VPC領域とサブネット作成
- 東京リージョンを選択
  - AWSマネジメントコンソールでは、一度リージョンを選択するとリージョンを変更し直すまでずっとそのリージョンに対する操作となる
- 「VPC」 → 「VPCの作成」をクリック
- VPC領域として「10.0.0.0/16」を作成
- 名前は「my-vpc-01」とする
- テナンシーはこのVPC領域上にインスタンスを作る時のデフォルトのテナント属性を設定する
  - デフォルトを選択した場合は他のユーザと共有するハードウェア上で実行される（コスト低い）
  - ハードウェア専有を使うと他のAWSユーザの影響を受けない利点があるが、コストが高くなる
  - 特に理由がなければデフォルトを選択で

### サブネットの作成
- 「サブネット」 → 「サブネットの作成」をクリック
- ネームタグ、VPC、アベイラビリティゾーン、CIDRブロックを決める
  - ネームタグ「my-subnet-01」
  - VPC「my-vpc-01」
  - アベイラビリティゾーンはお好みで決める。「指定なし」にするとランダムに選ばれる。

### AWSマネジメントコンソールのUIは変わる
- 頻繁に変わるので、基本を押させて操作できるように。

### EC2インスタンスに割り当てられるIPアドレス
- 物理サーバではNIC：Network Interface Card
- AWSでNICに相当するのが「ENI：Elastic Network Interface」
  EC2インスタンス作成時に一緒に新しいENIが作成され、アタッチされるのがデフォルトの挙動

### DHCPサーバ
- AWSのサブネット上ではDHCPサーバ機能が動作している
- サブネットに設定されたDHCPサーバ機能を止めることはできない
- 予約アドレス
  - IPアドレス先頭    ネットワークアドレスとして使用
  - IPアドレス先頭+1  VPCルーターで使用
  - IPアドレス先頭+2  Amazonが提供するDNSへのマッピング用に予約
  - IPアドレス先頭+3  将来のための予約
  - IPアドレス末尾    ブロードキャストアドレスとして予約
  
### プライマリプライベートIPアドレスとセカンダリプライベートIPアドレス
- ENIは必ず1つのプライベートIPアドレスを持つ、このIPアドレスをプライマリプライベートIPアドレスという。
- 追加して別のプライベートIPアドレスを持つこともでき、これをセカンダリプライベートIPアドレスという。
- プライマリプライベートIPアドレスは一度定まると以降はずっと同じまま。

### 固定IPアドレスの割り当て
- ENIには固定IPアドレスを設定することもできる。
- セカンダリプライベートIPアドレスはいつでも変更できるが、プライマリプライベートIPアドレスは  
  ENIを作成するときに決まるため、プライマリプライベートIPアドレスを固定IPアドレスにしたいなら  
  「ENIを作成すろとき（EC2インスタンスを作成するとき）」に固定IPを指定しなければならない。
- EC2インスタンスを起動したあとに、どうしても変更したい場合は、EC2インスタンスを複製するしか方法がない。

### 勝手なIPアドレスを利用してはいけない
- 固定IPアドレスに設定する場合の動作は、そのENIに対して常に同じIPアドレスを割り当てるようにDHCPサーバの設定を変更するという意味。
- そのためEC2インスタンスにインストールするOSの「IPアドレスの取得方法」に関する設定は、たとえ固定IPアドレスを利用する場合であっても、DHCPを利用するように構成する。
- AWSにおいて、IPアドレスの割り当ては常にサブネットのDHCPサーバ機能であるため、これを無視して買ってなIPアドレスを利用することは許されない。

### DHCPサーバのオプションはVPC単位で指定
- DHCPサーバでDNSサーバやデフォルトのドメイン名などを指定することもできる
- そういうDHCPサーバのオプションはVPC領域単位で指定する
- AWSマネジメントコンソールでVPC領域を確認すると、「DHCPオプションセット」という項目がうある

### EC2インスタンスの種類
- AWSでは性能が異なるさまざまなEC2インスタンスタイプが提供されている
- EC2インスタンスは稼働時間1時間当たりの従量課金、高性能なインスタンスタイプほど高価
- 性能のち外を決める項目は主に7項目
  - １．CPU性能（ほとんどのインスタンスタイプはCPUパワーが固定、T2インスタンスだけ負荷が高まったときに一定範囲内で一時的に成功を向上させるバースト機能を搭載している）
  - ２．メモリ
  - ３．GPU（3DレンダリングやGPUに対応した機械学習ソフトウェアを使って高速に演算したいときはGPUに対応したインスタンスタイプを選ぶように）
  - ４．ストレージとの接続速度（EC2インスタンスはAmazon EBS(Amazon Elastic Block Strage)にデータを保存する、インスタンスタイプによってはEBSと接続するバス幅が異なり、より高速なアクセスできるものがある）
  - ５．インスタンスストアの有無（停止すると失われる揮発性のディスクを備えているものがあり、これをインスタンスストアと言う）
  - ６．ネットワーク性能（最大通信速度）
  - ７．ネットワークインタフェース数やIPアドレスの制限
- 主なインスタンスタイプ（「用途名.性能」）
  - 性能「CPU性能」「ネットワークパフォーマンス」
  - 「nano」「micro」「small」「medium」「large」「xlarge」「2xlarge」「4xlarge」…「32xlarge」…
  - 「t2.micro」は1ヶ月に750時間まで無料枠
  - 実験・開発用であれば「nano」や「micro」、一般的な実運用なら「small」以上。

### ストレージの種類
- 「HDD」と「SSD」がある
- 確保した容量で従量課金される。

### OSはAMIで指定
- AWSではさまざまなAMIが提供されている
- 日本国内でよく使われているのは、AWSがサポートおよび保守管理している「Amazon Linux」というAMI。
  → Red Hat Enterprise Linuxライクで、Amazon用の管理ツールなどが含まれている。

### EC2インスタンスをリモート操作する
- EC2インスタンスはクラウドのサーバなので、設置したあとは、インターネットからネットワーク越しにアクセスしてリモート操作することになる
- リモート操作方法はインストールしたOSごとに異なる
  - Linux, Unix系はSSH(Secure Shell)を使って操作する
  - Windows系はリモートデスクトップを使って操作する
- SSHで操作するためには暗号化に用いる「キーペア」をセットアップする
- キーペアをなくしてしまうとEC2インスタンスを操作できなくなるので注意する
- Windows Serverのインスタンスを作る場合もキーペアが作られるが、  
  Windows Serverの場合はキーペアはSSHで接続するためではなく、リモートデスクトップ接続で使う初回パスワードを取得するために使われる。

### SSH操作にはパブリックIPアドレスが必要
- SSHでEC2インスタンスを操作するには、そのEC2インスタンスにパブリックIPアドレスを割り当ててインターネットから到達できなければならない
- プライベートIPアドレスしか設定していないEC2インスタンスには到達できないので操作できない

### EC2インスタンスをサブネットに配置する
- 「EC2」メニューを開く
- AMIを選択
- インスタンスタイプを選ぶ
- インスタンスの配置先などを選択
- インスタンスのタグ付け（デフォルトでは名前がわかりにくいので名前をつける）
- セキュリティグループの設定
  - セキュリティグループはインスタンスを出入りするパケットに対するパケットフィルタ型のファイアウォール機能。
- キーペアの作成
  - キーペアファイルには秘密鍵も含まれているので、誰にも読み取られない場所に保存しておくこと。
  - キーペア作成画面でダウンロードし損ねると再度とダウンロードできない。

### EC2インスタンスのIPアドレスの確認
- 「インスタンス」には起動中のインスタンス一覧が表示される。
- インスタンスをクリックするとその下にインスタンスの詳細情報が表示される。
- IPアドレス、プライベートDNS（DNS名）←これはDHCPサーバから指定されている名称であり、DHCPサーバの設定で変更可能

### ENIを確認する
- IPアドレスが割り当てられているのは正確にはENI
- 「ネットワークインターフェイス」の部分で確認できる。
- 「eth0」などとインターフェイス名が表示されているので、クリックするとENIの名称を確認できる。
- ENIを別のEC2インスタンスに装着することもできる
  - 物理サーバーで言う所の、別サーバからネットワークカードを抜き、それを新しいサーバに取り付ける操作のイメージ
  - EC2インスタンスが壊れて交換したいときなどに使うテクニック

### EC2インスタンスをインターネットに雪像
- VPC上のEC2インスタンスをインターネットに接続するには、パブリックIPアドレスを割り当てるだけでは十分ではない
- インターネットゲートウェイを用意し、ルートテーブルも変更しなければならない

### パブリックIPアドレスの割り当て
- EC2インスタンスへパブリックIPアドレスを割り当てる
- EC2インスタンスに対してどのようなIPアドレスを割り当てるかはEC2インスタンスを作成するときに決める。
- その設定は「インスタンスの詳細の設定」の「自動割り当てパブリックIP」で行う
- 設定値は、「サブネット設定を使用」か「有効化」か「無効化」のいずれか。
- 「サブネット設定を使用」にしたときは、サブネットでの設定が行われる。
- 配置先のサブネットでパブリックIPが有効になっていない場合、EC2インスタンスにパブリックIPが割り当てられない。
- そこでサブネットの設定で「パブリックIPアドレスを使用」に設定して、EC2インスタンスを作り直し（設定を変更）してもう一度起動する。

### インターネットゲートウェイの設置
- インターネットとの通信経路となるインターネットゲートウェイを用意する。
- これをサブネットではなくVPCに対して設置する。

### ルートテーブルの変更
- インターネットゲートウェイを設置したら、サブネットのデフォルトゲートウェイとして設定する。
- そうすることで自分のネットワーク宛て以外のデータが、インターネットゲートウェイを通るようになり、インターネットと通信できるようになる。
- VPCにおけるルーティング情報はルートテーブルとして構成されており、サブネット単位で設定する
- ルートテーブルは「送信先」と「ターゲット」を指定したルート情報の集まりで、指定した送信先のデータをどのターゲットに届けるかを定めるもの。
- ルールがない送信先のパケットは消失する。

### パブリックIPアドレスはNATで変換されている
- AWSにおけるパブリックIPアドレスは少し特殊で、NATによる運用がなされている
- パブリックIPアドレスを割り当てたとしても、EC2インスタンスには以前としてプライベートIPアドレスしか割り当てられない。
- 代わりにNAT機能で「プライベートIPアドレス」と「パブリックIPアドレス」の相互変更が行われるようになっている。
- ipconfigコマンドなどの一般的な方法では割り当てられたパブリックIPアドレスを知ることができない
- パブリックIPアドレスを知りたいときはメタデータサーバーから取得する



### 参考書籍
- {% include book/book_946.html %} {% comment %} Amazon Web Servicesネットワーク入門 {% endcomment %}

{% include goto_pagetop.html %}

{% include footnotes_link.html %}
